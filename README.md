# README

这是一个基于Python Tkinter的GUI工具脚本，用于监控日志文件中的进度信息，并提供相应的统计和显示功能。

## 科学计算程序的进度监控

对于一个耗时的科学计算程序，我们通常很关心它的运行进度，但是要求程序自身来提供可视化的进度信息通常是不合适的：

- 有的编程语言所编写的科学计算程序无法直接提供图形界面的进度条，例如C/C++/Fortran编写的程序，只能在控制台上输出字符；
- 如果直接在控制台实现进度条，其它必要信息的输出必然会频繁打乱进度条的显示，而且在终端中还会遇到编码和终端尺寸变化问题，这些都会影响进度条的效果。

我们可以使用间接方案：科学计算程序只负责将当前时间戳和当前进度不断地输出到日志文件中，然后通过监控这个日志文件来获取进度信息。例如科学计算程序只需要不断地在日志文件`progress.log`的末尾新建一行，包括指定格式的时间戳和进度百分比
```
[2024-07-28 23:24:46.769] 4.17%
```
然后通过读取日志文件就可以获得程序运行的进度并预估完成时刻了。

间接方案将进度信息的提供过程与处理过程分离，既简化了科学计算程序的编写，也允许我们使用统一的后处理脚本来处理和显示进度信息，并且处理过程完全不会干扰科学计算程序自身的运行。

在Linux上可以直接使用`tail`命令实现动态监控日志的功能
```bash
tail -f ./progress.log
```
在Windows PowerShell中也有等价的命令
```powershell
Get-Content -Path ./progress.log -Wait
```
但是这些命令只是忠实地展示不断增长的日志文件中的最新内容，并不是专门为科学计算程序的进度监控定制的，这也是我们编写当前脚本的目的。


## 主要功能

`progress_monitor.py`脚本除了以GUI形式实现了`tail -f`命令的等价效果，还针对科学计算程序的实际需求实现了一些定制功能，主要功能包括：

- 和`tail -f`命令一样，忠实地在输出文本框中展示不断增长的日志文件中的最新内容
- 在输出文本框中还会输出脚本自身产生的提示/警告/错误信息，它们会以彩色字体输出，便于与日志文件内容区分
- 逐行解析以获取日志文件中的时间戳和进度百分比
  - 按照固定的格式解析时间戳和进度百分比
    - 对于时间戳，允许出现在一行中的任意位置，目前支持几种不同格式的时间戳，但是都要求必须精确到毫秒级，并且需要放在中括号中，例如`[2024-07-28 23:24:46.769]`
    - 对于当前进度，允许出现在一行中的任意位置，但是要求必须是以`%`结尾的百分比数据，并要求且在`0-100%`之间，例如`4.17%`
  - 自动将获取的进度以进度条的方式呈现
- 预估剩余时间和完成时刻：使用指数平滑法，结合历史数据和当前数据来预测剩余时间和完成时刻
- 探测日志文件中的其它信息：（关键词不区分大小写）
  - 通过匹配关键字`error`和`warning`来探测错误和警告信息
  - 匹配关键字`inf`和`nan`并将其视作错误信息
  - 探测代表进度终止的关键词（`end`和`finish`），此时会关闭文件然后重新打开
  - 记录并显示探测到的第一条错误信息（第一个错误通常是最关键的）
  - 统计日志中错误和警告信息出现的次数（不包括脚本自身产生的错误和警告）


## 使用方法

1. 运行脚本 `python progress_monitor.py`。
2. 点击“浏览”按钮，选择需要监控的日志文件。
3. 点击“开始/停止”按钮，开始监控选定的日志文件。应用程序将自动读取文件中的进度信息并进行显示和统计。
4. 点击“开始/停止”按钮，停止监控当前文件。
5. 点击“重置”按钮，停止监控并重置所有的内部数据和显示信息。
